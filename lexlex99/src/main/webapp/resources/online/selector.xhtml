<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:composite="http://java.sun.com/jsf/composite">
	
	<composite:interface>
		<composite:attribute name="bean" required="true" displayName="Caller bean which implement SelectorListener" />
		<composite:attribute name="updateOnSelected" displayName="Comp updated when selected" />
		<composite:attribute name="widgetVar" displayName="Widget var accessible by JS" />
		<composite:attribute name="title" displayName="Name itself depict what it does" />
		<composite:attribute name="width" displayName="Name itself depict what is does" />
		<composite:attribute name="height" displayName="Name itself depict what it does" />
		<composite:attribute name="isSelected" default="true" displayName="false or true" />
		<composite:attribute name="selectorInfo" displayName="Selector info, columns, properties and db query" />
		<composite:attribute name="selectorInfoWithCriteria" displayName="Selector info, columns, properties and db query" />
	</composite:interface>
	
	<composite:implementation>
		<p:dialog id="selectorDialog#{cc.attrs.id}" position="center" appendToBody="true" fitViewport="true"
			header="#{cc.attrs.title}" widgetVar="#{cc.attrs.widgetVar}" responsive="true"
			height="#{cc.attrs.height}" width="#{cc.attrs.width}" onShow="$(PF('btnSearch#{cc.attrs.id}').jqId).click()">
		
			<h:form id="selectorForm#{cc.attrs.id}" onsubmit="return false;">
				<p:remoteCommand name="reset#{cc.attrs.id}AndShow"
					actionListener="#{mbLovCommon.reset(cc.attrs.id)}"
					oncomplete="$(txtSearch#{cc.attrs.id}.jqId).val('');PF('#{cc.attrs.widgetVar}').show();"
					update="selectorTable#{cc.attrs.id}" />
					
				<p:remoteCommand name="doSearch#{cc.attrs.id}"
					actionListener="#{mbLovCommon.search(cc.attrs.id)}"
					update="selectorTable#{cc.attrs.id}"
					process="@form"/>
					
				<table>
				  <tr>
				    <td>
				    	<input type="hidden" name="hdnParam#{cc.attrs.id}" class="hdnParam#{cc.attrs.id}" />
				    	<table>
				    		<tr>
				    			<td style="width:80%">
				    				<input type="text" class="form-control" style="display: #{cc.attrs.isSelected == true ? '' : 'none'}" id="txtSearch#{cc.attrs.id}" name="txtSearch#{cc.attrs.id}"/>
				    			</td>
				    			<td>
				    				<h:outputText value="-" style="color: white" />
				    			</td>
				    			<td style="width: 20%">
				    				<p:commandButton style="display: #{cc.attrs.isSelected == true ? '' : 'none'}" styleClass="btn btn-primary pull-left tl-label" id="btnSearch#{cc.attrs.id}" process="@form" widgetVar="btnSearch#{cc.attrs.id}" value="Search" action="#{mbLovCommon.search(cc.attrs.id)}" update="selectorTable#{cc.attrs.id}"></p:commandButton>
				    			</td>
				    		</tr>
				    	</table>
				    </td>
				  </tr>
				</table>
				
				<p:dataTable var="item" value="#{mbLovCommon.getDataModel(cc.attrs.id, cc.attrs.selectorInfo)}" rows="10"
					lazy="true" paginator="true" paginatorPosition="top"
					rowIndexVar="rowIndex" reflow="true" styleClass="table-needs-hover-marker"
					id="selectorTable#{cc.attrs.id}">
				
					<p:columns value="#{mbLovCommon.getColumnModel(cc.attrs.id)}"
						var="column" columnIndexVar="colIndex">
					
						<f:facet name="header">
							#{column.header}
						</f:facet>
						<p:outputPanel id="panelLeft#{cc.attrs.id}"
							rendered="#{mbLovCommon.alignLeft(item[column.property])}">
							#{item[column.property]}
						</p:outputPanel>
						
						<p:outputPanel id="panelRight#{cc.attrs.id}" style="width: 100%"
							rendered="#{mbLovCommon.alignRight(item[column.property])}">
							<div style="width: 100%; text-align: right;">
								#{item[column.property]}
							</div>
						</p:outputPanel>
					</p:columns>
					
					<p:column headerText="Action" width="80" rendered="#{cc.attrs.isSelected}">
						<p:commandLink id="btnSelect#{cc.attrs.id}" value="Choose" rendered="#{cc.attrs.isSelected}"
							actionListener="#{mbLovCommon.select(cc.attrs.id, cc.attrs.widgetVar, cc.attrs.bean, item, cc.attrs.selectorInfo)}"
							update="#{cc.attrs.updateOnSelected}"
							onsuccess="PF('#{cc.attrs.widgetVar}').hide();"
							process="@this"></p:commandLink>
					</p:column>
					
				</p:dataTable>
			</h:form>
		</p:dialog>
	</composite:implementation>	
</html>